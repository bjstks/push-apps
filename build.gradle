buildscript {
    ext.kotlinVersion = '1.1.51'
    ext.junitPlatformVersion = '1.0.1'
    repositories {
        mavenCentral()
    }
    dependencies {
        classpath "org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlinVersion"
        classpath "org.junit.platform:junit-platform-gradle-plugin:$junitPlatformVersion"
    }
}

apply from: "$rootProject.rootDir/version.gradle"

task wrapper(type: Wrapper) {
    gradleVersion = '4.3.1'
}

task bumpPatch(type: UpdatePatchVersionTask) {
    versionFilePath = "$rootProject.rootDir/version.gradle"
}

class UpdatePatchVersionTask extends DefaultTask {
    @Input
    String versionFilePath

    @TaskAction
    def updatePatchVersion() {
        def versionFile = new File(versionFilePath)
        def currentVersion = versionFile.text
        def versionStringParts = currentVersion.split("\\.")
        def patchInt = Integer.parseInt(versionStringParts.last().replace("'\n", ""))
        versionStringParts[versionStringParts.size() - 1] = (patchInt + 1).toString() + "'\n"

        versionFile.text = versionStringParts.join(".")
    }
}
